<!DOCTYPE html>
<html>
<head>
    <title>Grainy Distorted Gradient Blobs</title>
    <link rel="stylesheet" href="codePen8.css">
    <script src="codePen8.js"></script>
</head>
<body style="--d: 400px">
    <svg width="0" height="0" aria-hidden="true">
        <!-- distort gradient shape (relative to distorted input d) -->
        <filter id="distort" primitiveUnits="objectBoundingBox" x="-50%" y="-50%" width="200%" height="200%">
            <feTurbulence type="fractalNoise" baseFrequency=".00713" seed="5"></feTurbulence>
            <feDisplacementMap in="SourceGraphic" scale=".3" yChannelSelector="R"></feDisplacementMap>
        </filter>
        <!-- make gradient grainy (absolute, in px) -->
        <filter id="grain" x="-50%" y="-50%" width="200%" height="200%">
            <feTurbulence type="fractalNoise" baseFrequency="7.13"></feTurbulence>
            <feDisplacementMap in="SourceGraphic" scale="36" yChannelSelector="R"></feDisplacementMap>
        </filter>
    </svg>
    
    <section class="intro">
        <h1>Grainy distorted gradient blobs</h1>
        <p>Each distorted blob starts out as a 
            <code>circle</code>, 
            <a href="https://css-tricks.com/tight-fitting-svg-shapes/" target="_blank">tightly fit</a> inside its parent 
            <code>svg</code> element (which has its 
            <code>viewBox</code> set such that its 
            <code>0,0</code> point 
            <a href="https://bsky.app/profile/anatudor.bsky.social/post/3ljb65y7wns2o" target="_blank">is dead in the middle</a>). This circle then gets a 
            <code>radialGradient</code> fill. Choosing the SVG radial gradient over the CSS one because it 
            <a href="https://svgwg.org/svg2-draft/pservers.html#RadialGradientElement" target="_blank">also allows</a> setting focal point coordinates (
            <code>fx,fy</code>) distinct from 
            <code>cx,cy</code> - hover any blob to see how its focal point follows the cursor.
        </p>
        <pre>
            <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">radialGradient</span> <span class="tkn--attr">id</span><span class="tkn--punc">=</span><span class="tkn--str">'g'</span> <span class="tkn--attr">gradientUnits</span><span class="tkn--punc">=</span><span class="tkn--str">'objectBoundingBox'</span> <span class="tkn--attr">fx</span><span class="tkn--punc">=</span><span class="tkn--str">'.35'</span> <span class="tkn--attr">fy</span><span class="tkn--punc">=</span><span class="tkn--str">'.65'</span><span class="tkn--punc">&gt;</span></span>
            <div class="blck">
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">stop</span> <span class="tkn--attr">stop-color</span><span class="tkn--punc">=</span><span class="tkn--str">'var(--c0)'</span><span class="tkn--punc">/&gt;</span></span>
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">stop</span> <span class="tkn--attr">stop-color</span><span class="tkn--punc">=</span><span class="tkn--str">'var(--c1)'</span> <span class="tkn--attr">offset</span><span class="tkn--punc">=</span><span class="tkn--str">'.5'</span><span class="tkn--punc">/&gt;</span></span>
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">stop</span> <span class="tkn--attr">stop-color</span><span class="tkn--punc">=</span><span class="tkn--str">'rgba(from var(--c1) r g b/ 0)'</span> <span class="tkn--attr">offset</span><span class="tkn--punc">=</span><span class="tkn--str">'1'</span><span class="tkn--punc">/&gt;</span></span>
            </div>
            <span class="line"><span class="tkn--punc">&lt;/</span><span class="tkn--elem">radialGradient</span><span class="tkn--punc">&gt;</span></span>
        </pre>
        <p>The 
            <code>circle</code> with the gradient is then blurred, distorted and given a grainy/ dithered look. The last two actions make use of the same concept of altering the input using noise generated by 
            <code>feTurbulence</code> as a 
            <a href="https://www.smashingmagazine.com/2021/09/deep-dive-wonderful-world-svg-displacement-filtering/" target="_blank">displacement map</a>. The displacement used for distortion is relative to input size. The noise used for dithering is finer (larger 
            <code>baseFrequency</code> value).
        </p>
        <pre>
            <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">filter</span> <span class="tkn--attr">id</span><span class="tkn--punc">=</span><span class="tkn--str">'distort'</span> <span class="tkn--attr">primitiveUnits</span><span class="tkn--punc">=</span><span class="tkn--str">'objectBoundingBox'</span> <span class="tkn--attr">x</span><span class="tkn--punc">=</span><span class="tkn--str">'-50%'</span> <span class="tkn--attr">y</span><span class="tkn--punc">=</span><span class="tkn--str">'-50%'</span> <span class="tkn--attr">width</span><span class="tkn--punc">=</span><span class="tkn--str">'200%'</span> <span class="tkn--attr">height</span><span class="tkn--punc">=</span><span class="tkn--str">'200%'</span><span class="tkn--punc">&gt;</span></span>
            <div class="blck">
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">feTurbulence</span> <span class="tkn--attr">type</span><span class="tkn--punc">=</span><span class="tkn--str">'fractalNoise'</span> <span class="tkn--attr">baseFrequency</span><span class="tkn--punc">=</span><span class="tkn--str">'.00713'</span><span class="tkn--punc">/&gt;</span></span>
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">feDisplacementMap</span> <span class="tkn--attr">in</span><span class="tkn--punc">=</span><span class="tkn--str">'SourceGraphic'</span> <span class="tkn--attr">scale</span><span class="tkn--punc">=</span><span class="tkn--str">'.3'</span> <span class="tkn--attr">yChannelSelector</span><span class="tkn--punc">=</span><span class="tkn--str">'R'</span><span class="tkn--punc">/&gt;</span></span>
            </div>
            <span class="line"><span class="tkn--punc">&lt;/</span><span class="tkn--elem">filter</span><span class="tkn--punc">&gt;</span></span>

            <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">filter</span> <span class="tkn--attr">id</span><span class="tkn--punc">=</span><span class="tkn--str">'grain'</span> <span class="tkn--attr">x</span><span class="tkn--punc">=</span><span class="tkn--str">'-50%'</span> <span class="tkn--attr">y</span><span class="tkn--punc">=</span><span class="tkn--str">'-50%'</span> <span class="tkn--attr">width</span><span class="tkn--punc">=</span><span class="tkn--str">'200%'</span> <span class="tkn--attr">height</span><span class="tkn--punc">=</span><span class="tkn--str">'200%'</span><span class="tkn--punc">&gt;</span></span>
            <div class="blck">
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">feTurbulence</span> <span class="tkn--attr">type</span><span class="tkn--punc">=</span><span class="tkn--str">'fractalNoise'</span> <span class="tkn--attr">baseFrequency</span><span class="tkn--punc">=</span><span class="tkn--str">'7.13'</span><span class="tkn--punc">/&gt;</span></span>
                <span class="line"><span class="tkn--punc">&lt;</span><span class="tkn--elem">feDisplacementMap</span> <span class="tkn--attr">in</span><span class="tkn--punc">=</span><span class="tkn--str">'SourceGraphic'</span> <span class="tkn--attr">scale</span><span class="tkn--punc">=</span><span class="tkn--str">'32'</span> <span class="tkn--attr">yChannelSelector</span><span class="tkn--punc">=</span><span class="tkn--str">'R'</span><span class="tkn--punc">/&gt;</span></span>
            </div>
                <span class="line"><span class="tkn--punc">&lt;/</span><span class="tkn--elem">filter</span><span class="tkn--punc">&gt;</span></span>
        </pre>
    </section>
    
    <section class="samples">
        <!-- The gradient blobs will be generated here -->
    </section>

    <script>
        // // Helper function to round numbers
        // function rnd(n, p = 2) { return +n.toFixed(p) }

        // // Function to create the gradient blobs
        // document.addEventListener('DOMContentLoaded', function() {
        //     const d = 400;
        //     const grad = [
        //         ['#ff6cab', '#7366ff'], 
        //         ['#2e8de1', '#b65eba'], 
        //         ['#8a64eb', '#64e8de'], 
        //         ['#e65eab', '#7bf2e9'], 
        //         ['#7d77ff', '#ff9482'], 
        //         ['#ff661b', '#ffcf1b'], 
        //         ['#ea4d2c', '#ffa62e'], 
        //         ['#00ff54', '#00b8ba'], 
        //         ['#6454f0', '#6ee2f5'], 
        //         ['#3499ff', '#3a3985'], 
        //         ['#f630a0', '#ff9897'], 
        //         ['#ee4d5f', '#ffcda5'], 
        //         ['#8441a4', '#ff5b94'], 
        //         ['#f869d5', '#5650de'], 
        //         ['#00bd56', '#f9fd50'], 
        //         ['#c7004c', '#ffaaaa'], 
        //         ['#fff6a2', '#fc8a15']
        //     ];
        //     const n = grad.length, r = 0.5 * d;
        //     const samplesSection = document.querySelector('.samples');
            
        //     grad.forEach((colors, i) => {
        //         // Create blob container
        //         const blobDiv = document.createElement('div');
        //         blobDiv.className = 'blob';
        //         blobDiv.style.setProperty('--c', `light-dark(${colors.slice().reverse()})`);
                
        //         // Create SVG
        //         const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        //         svg.setAttribute('viewBox', `${-r} ${-r} ${d} ${d}`);
                
        //         // Create radial gradient
        //         const radialGradient = document.createElementNS('http://www.w3.org/2000/svg', 'radialGradient');
        //         radialGradient.setAttribute('id', `g${i}`);
        //         radialGradient.setAttribute('gradientUnits', 'objectBoundingBox');
        //         radialGradient.setAttribute('fx', '.25');
        //         radialGradient.setAttribute('fy', '.75');
                
        //         // Create stops
        //         const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
        //         stop1.setAttribute('stop-color', `light-dark(${colors})`);
                
        //         const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
        //         stop2.setAttribute('stop-color', 'var(--c)');
        //         stop2.setAttribute('offset', '.5');
                
        //         const stop3 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
        //         stop3.setAttribute('offset', '1');
                
        //         // Create circle
        //         const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        //         circle.setAttribute('r', '50%');
        //         circle.setAttribute('fill', `url(#g${i})`);
        //         // Add "r" attribute to trigger the filters in CSS
        //         circle.setAttribute('r', ''); 
                
        //         // Append elements
        //         radialGradient.appendChild(stop1);
        //         radialGradient.appendChild(stop2);
        //         radialGradient.appendChild(stop3);
                
        //         svg.appendChild(radialGradient);
        //         svg.appendChild(circle);
                
        //         blobDiv.appendChild(svg);
        //         samplesSection.appendChild(blobDiv);
        //     });
        // });

        // // Mousemove event handler for interactive gradient focal point
        // addEventListener('mousemove', e => {
        //     let _t = e.target;
            
        //     if(_t.classList.contains('blob')) {
        //         let r = _t.getBoundingClientRect(), 
        //             _g = _t.querySelector('radialGradient'), 
        //             dx = (e.clientX - r.x)/r.width - .5, 
        //             dy = (e.clientY - r.y)/r.height - .5, 
        //             m = Math.min(.49, Math.hypot(dy, dx)), 
        //             a = Math.atan2(dy, dx);
                
        //         _g.setAttribute('fx', rnd(.5 + m*Math.cos(a)));
        //         _g.setAttribute('fy', rnd(.5 + m*Math.sin(a)));
        //     }
        // });
    </script>
</body>
</html>